<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Arkeo Data Marketplace</title>
  <link rel="icon" type="image/png" href="images/arkeo-logo-200px_1.png">
  <meta name="description" content="Decentralized RPC infrastructure marketplace. Connect to blockchain data providers with pay-as-you-go pricing.">
  <meta name="theme-color" content="#0a0c10">
  <!-- Open Graph -->
  <meta property="og:title" content="Arkeo Data Marketplace">
  <meta property="og:description" content="Decentralized RPC infrastructure. No signup. No KYC. Just connect and query.">
  <meta property="og:type" content="website">
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="js/config.js"></script>
  <script src="js/utils.js"></script>
  <style>
    :root {
      --bg-main: #0a0c10;
      --bg-card: #12151c;
      --bg-card-hover: #181c25;
      --bg-input: #1a1f2a;
      --border: #252a36;
      --border-hover: #3BE0FF;
      --arkeo: #3BE0FF;
      --arkeo-dim: rgba(59, 224, 255, 0.1);
      --arkeo-glow: rgba(59, 224, 255, 0.3);
      --success: #10b981;
      --warning: #f59e0b;
      --error: #ef4444;
      --text: #ffffff;
      --text-dim: #8b92a5;
      --text-muted: #5a6278;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    .hidden { display: none !important; }

    body {
      background: var(--bg-main);
      color: var(--text);
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Inter', sans-serif;
      line-height: 1.6;
      min-height: 100vh;
    }

    /* Navigation */
    .nav {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 1rem 2rem;
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .nav-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 1.25rem;
      font-weight: 700;
      text-decoration: none;
      color: var(--text);
    }
    .logo img { height: 40px; }
    .logo-text span { color: var(--arkeo); }
    
    .nav-links {
      display: flex;
      align-items: center;
      gap: 2rem;
    }
    .nav-link {
      color: var(--text-dim);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s;
    }
    .nav-link:hover { color: var(--arkeo); }
    .nav-link.active { color: var(--arkeo); }

    .btn {
      padding: 0.75rem 1.5rem;
      border-radius: 0.5rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }
    .btn-primary {
      background: var(--arkeo);
      color: #000;
    }
    .btn-primary:hover {
      box-shadow: 0 0 20px var(--arkeo-glow);
    }
    .btn-secondary {
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
    }
    .btn-secondary:hover {
      border-color: var(--arkeo);
      color: var(--arkeo);
    }
    .btn-outline {
      background: transparent;
      color: var(--arkeo);
      border: 1px solid var(--arkeo);
    }
    .btn-outline:hover {
      background: var(--arkeo-dim);
    }
    .btn-buy {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: #000;
      font-weight: 600;
    }
    .btn-buy:hover {
      box-shadow: 0 0 20px rgba(245, 158, 11, 0.4);
    }
    .btn-provide,
    .btn-use {
      background: linear-gradient(135deg, #3be0ff, #2bb8d4);
      color: #fff;
      font-weight: 600;
      border: none;
    }
    .btn-provide:hover,
    .btn-use:hover {
      filter: brightness(1.05);
      box-shadow: 0 10px 30px rgba(255, 79, 210, 0.25);
    }
    .nav-buttons {
      display: flex;
      gap: 0.5rem;
      align-items: center;
    }
    .nav-btn {
      padding: 0.45rem 0.9rem;
      border-radius: 0.375rem;
      font-weight: 500;
      font-size: 0.8rem;
      cursor: pointer;
      transition: all 0.2s;
      border: 1px solid var(--border);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      color: var(--text);
      background: transparent;
    }
    .nav-btn:hover {
      color: var(--arkeo);
      border-color: var(--arkeo);
      background: rgba(59, 224, 255, 0.05);
    }
    .nav-btn-accent {
      border-color: rgba(59, 224, 255, 0.3);
      color: var(--arkeo);
    }
    .nav-btn-accent:hover {
      background: rgba(59, 224, 255, 0.1);
      border-color: var(--arkeo);
    }

    /* Hero Section */
    .hero {
      text-align: center;
      padding: 4rem 2rem;
      background: linear-gradient(180deg, var(--bg-card) 0%, var(--bg-main) 100%);
      border-bottom: 1px solid var(--border);
    }
    .hero h1 {
      font-size: 3rem;
      font-weight: 700;
      margin-bottom: 1rem;
      background: linear-gradient(135deg, var(--text) 0%, var(--arkeo) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .hero p {
      font-size: 1.25rem;
      color: var(--text-dim);
      max-width: 600px;
      margin: 0 auto 2rem;
    }
    .hero-buttons {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
    }

    /* Stats Bar */
    .stats-bar {
      background: var(--bg-card);
      border-bottom: 1px solid var(--border);
      padding: 1.5rem 2rem;
    }
    .stats-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 2rem;
    }
    .stat {
      text-align: center;
    }
    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--arkeo);
    }
    .stat-label {
      font-size: 0.875rem;
      color: var(--text-dim);
      margin-top: 0.25rem;
    }

    /* Main Content */
    .main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Section Headers */
    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 1.5rem;
    }
    .section-title {
      font-size: 1.5rem;
      font-weight: 600;
    }

    /* Filters */
    .filters {
      display: flex;
      gap: 1rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }
    .filter-input {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      background: var(--bg-input);
      color: var(--text);
      min-width: 200px;
    }
    .filter-input:focus {
      outline: none;
      border-color: var(--arkeo);
    }
    .filter-select {
      padding: 0.75rem 1rem;
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      background: var(--bg-input);
      color: var(--text);
      cursor: pointer;
    }

    /* Provider Grid */
    .provider-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 1.5rem;
    }

    /* Provider Card */
    .provider-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 1.5rem;
      transition: all 0.2s;
    }
    .provider-card:hover {
      border-color: var(--arkeo);
      background: var(--bg-card-hover);
      transform: translateY(-2px);
    }
    .provider-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 1rem;
    }
    .provider-name {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.25rem;
    }
    .provider-service {
      font-size: 0.875rem;
      color: var(--text-dim);
    }
    .provider-status {
      padding: 0.25rem 0.75rem;
      border-radius: 1rem;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
    }
    .provider-status.online {
      background: rgba(16, 185, 129, 0.1);
      color: var(--success);
    }
    .provider-status.offline {
      background: rgba(239, 68, 68, 0.1);
      color: var(--error);
    }

    .provider-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1rem;
      margin: 1rem 0;
      padding: 1rem 0;
      border-top: 1px solid var(--border);
      border-bottom: 1px solid var(--border);
    }
    .provider-stat {
      text-align: center;
    }
    .provider-stat-value {
      font-weight: 600;
      color: var(--arkeo);
    }
    /* View Toggle */
    .view-toggle {
      width: 36px;
      height: 36px;
      border: 1px solid var(--border);
      background: var(--bg-input);
      color: var(--text-dim);
      border-radius: 0.5rem;
      cursor: pointer;
      font-size: 1rem;
      transition: all 0.2s;
    }
    .view-toggle:hover {
      border-color: var(--arkeo);
      color: var(--arkeo);
    }
    .view-toggle.active {
      background: var(--arkeo);
      color: #000;
      border-color: var(--arkeo);
    }

    /* Provider Table */
    .provider-table-container {
      overflow-x: auto;
      border-radius: 1rem;
      border: 1px solid var(--border);
      background: var(--bg-card);
    }
    .provider-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9rem;
    }
    .provider-table th {
      text-align: left;
      padding: 1rem;
      background: var(--bg-input);
      color: var(--text-dim);
      font-weight: 600;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      border-bottom: 1px solid var(--border);
    }
    .provider-table td {
      padding: 1rem;
      border-bottom: 1px solid var(--border);
      vertical-align: middle;
    }
    .provider-table tr:last-child td {
      border-bottom: none;
    }
    .provider-table tr:hover {
      background: var(--bg-card-hover);
    }
    .provider-table .provider-name-cell {
      font-weight: 600;
    }
    .provider-table .provider-name-cell small {
      display: block;
      font-weight: 400;
      color: var(--text-dim);
      font-size: 0.75rem;
    }
    .provider-table .data-types {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
    }
    .provider-table .chain-tag {
      background: var(--arkeo-dim);
      color: var(--arkeo);
      padding: 0.125rem 0.5rem;
      border-radius: 0.25rem;
      font-size: 0.7rem;
      font-weight: 500;
    }
    .provider-table .chain-tag.more {
      background: var(--bg-input);
      color: var(--text-dim);
    }
    .provider-table .earnings {
      color: var(--success);
      font-weight: 600;
    }
    .provider-table .transactions {
      color: var(--text);
    }
    .provider-table .btn-sm {
      padding: 0.375rem 0.75rem;
      font-size: 0.8rem;
    }

    .provider-stat-label {
      font-size: 0.75rem;
      color: var(--text-dim);
    }

    .provider-actions {
      display: flex;
      gap: 0.75rem;
      margin-top: 1rem;
    }
    .provider-actions .btn {
      flex: 1;
      justify-content: center;
      padding: 0.625rem 1rem;
      font-size: 0.875rem;
    }

    /* CTA Cards */
    .cta-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 1.5rem;
      margin: 3rem 0;
    }
    .cta-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      text-align: center;
      transition: all 0.2s;
    }
    .cta-card:hover {
      border-color: var(--arkeo);
      transform: translateY(-2px);
    }
    .cta-icon {
      font-size: 3rem;
      margin-bottom: 1rem;
    }
    .cta-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    .cta-description {
      color: var(--text-dim);
      margin-bottom: 1.5rem;
      font-size: 0.9rem;
    }

    /* Momentum Section */
    .momentum-section {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
    }
    .momentum-section::before {
      content: '';
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(59, 224, 255, 0.15), transparent 50%),
                  radial-gradient(circle at bottom left, rgba(59, 224, 255, 0.1), transparent 45%);
      pointer-events: none;
    }
    .momentum-content {
      position: relative;
      z-index: 1;
      display: grid;
      grid-template-columns: 1fr 2fr;
      gap: 2rem;
      align-items: stretch;
    }
    @media (max-width: 900px) {
      .momentum-content {
        grid-template-columns: 1fr;
      }
    }
    .momentum-text h2 {
      font-size: 1.75rem;
      font-weight: 700;
      margin-bottom: 1rem;
      line-height: 1.3;
    }
    .momentum-text p {
      color: var(--text-dim);
      font-size: 0.9rem;
      margin-bottom: 1rem;
    }
    .momentum-badge {
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      padding: 0.5rem 1rem;
      background: var(--arkeo-dim);
      color: var(--arkeo);
      border-radius: 2rem;
      font-size: 0.75rem;
      font-weight: 600;
      margin-bottom: 1rem;
    }
    .momentum-buttons {
      display: flex;
      gap: 1rem;
      margin-top: 1.5rem;
    }
    .time-filters {
      display: flex;
      gap: 0.25rem;
    }
    .time-filter {
      padding: 0.375rem 0.75rem;
      border-radius: 0.375rem;
      font-size: 0.75rem;
      font-weight: 500;
      background: transparent;
      color: var(--text-dim);
      border: none;
      cursor: pointer;
      transition: all 0.2s;
    }
    .time-filter:hover {
      background: var(--bg-card);
    }
    .time-filter.active {
      background: var(--arkeo);
      color: #000;
    }
    .no-data {
      position: absolute;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text-dim);
      font-size: 0.9rem;
    }

    /* Racing Section */
    .racing-section {
      background: linear-gradient(135deg, rgba(59, 224, 255, 0.08), rgba(43, 184, 212, 0.08));
      border: 1px solid rgba(59, 224, 255, 0.25);
      border-radius: 1rem;
      padding: 2rem;
      margin-bottom: 2rem;
      overflow: hidden;
    }
    .racing-content {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 2rem;
      align-items: center;
    }
    @media (max-width: 768px) {
      .racing-content {
        grid-template-columns: 1fr;
        text-align: center;
      }
      .racing-visual { order: -1; }
    }
    .racing-text h2 {
      font-size: 1.5rem;
      font-weight: 700;
      margin-bottom: 0.75rem;
    }
    .racing-text p {
      color: var(--text-dim);
      font-size: 0.9rem;
    }
    .racing-text ul li {
      margin-bottom: 0.25rem;
    }
    .race-track {
      background: linear-gradient(90deg, #1a1f2a, #252a36);
      border-radius: 0.5rem;
      padding: 1rem;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }
    .race-track::after {
      content: 'üèÅ';
      position: absolute;
      right: 0.5rem;
      top: 50%;
      transform: translateY(-50%);
      font-size: 1.5rem;
    }
    .horse {
      font-size: 1.5rem;
      animation: race var(--speed) ease-in-out infinite;
      animation-delay: var(--delay);
    }
    @keyframes race {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(100px); }
    }

    /* Loading */
    .loading {
      text-align: center;
      padding: 3rem;
      color: var(--text-dim);
    }
    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top-color: var(--arkeo);
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
      margin: 0 auto 1rem;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* Footer */
    .footer {
      background: var(--bg-card);
      border-top: 1px solid var(--border);
      padding: 2rem;
      margin-top: 4rem;
    }
    .footer-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 1rem;
    }
    .footer-links {
      display: flex;
      gap: 2rem;
    }
    .footer-link {
      color: var(--text-dim);
      text-decoration: none;
      font-size: 0.875rem;
    }
    .footer-link:hover { color: var(--arkeo); }

    /* Reputation Score */
    .rep-score {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      font-weight: 700;
      cursor: help;
    }
    .rep-bar {
      display: inline-block;
      height: 6px;
      border-radius: 3px;
      background: var(--border);
      width: 60px;
      position: relative;
      overflow: hidden;
    }
    .rep-bar-fill {
      position: absolute;
      left: 0; top: 0; bottom: 0;
      border-radius: 3px;
      transition: width 0.4s;
    }
    .rep-gold .rep-bar-fill { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
    .rep-silver .rep-bar-fill { background: linear-gradient(90deg, #94a3b8, #cbd5e1); }
    .rep-bronze .rep-bar-fill { background: linear-gradient(90deg, #b45309, #d97706); }
    .rep-none .rep-bar-fill { background: var(--text-muted); }
    .rep-gold { color: #fbbf24; }
    .rep-silver { color: #cbd5e1; }
    .rep-bronze { color: #d97706; }
    .rep-none { color: var(--text-dim); }
    .rep-card {
      text-align: center;
      padding: 0.75rem;
      margin-bottom: 0.75rem;
      border-radius: 0.75rem;
      background: rgba(59, 224, 255, 0.05);
      border: 1px solid var(--border);
    }
    .rep-card-score {
      font-size: 1.75rem;
      font-weight: 800;
      line-height: 1;
    }
    .rep-card-label {
      font-size: 0.7rem;
      color: var(--text-dim);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .rep-info-section {
      background: linear-gradient(135deg, rgba(59, 224, 255, 0.06), rgba(59, 224, 255, 0.02));
      border: 1px solid rgba(59, 224, 255, 0.3);
      border-radius: 0.75rem;
      margin-bottom: 1.5rem;
      overflow: hidden;
    }
    .rep-info-toggle {
      width: 100%;
      padding: 1rem 1.25rem;
      background: none;
      border: none;
      color: var(--arkeo);
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: all 0.2s;
    }
    .rep-info-toggle:hover { color: #fff; background: rgba(59, 224, 255, 0.08); }
    .rep-info-body {
      padding: 0 1rem 1rem;
      color: var(--text-dim);
      font-size: 0.85rem;
      line-height: 1.6;
    }
    .rep-info-body ul {
      margin: 0.5rem 0;
      padding-left: 1.5rem;
    }
    .rep-info-body li { margin-bottom: 0.25rem; }

    /* Responsive - Tablet */
    @media (max-width: 1024px) {
      .momentum-content {
        grid-template-columns: 1fr;
      }
      .cta-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    /* Responsive - Mobile */
    @media (max-width: 768px) {
      .nav { padding: 0.75rem 1rem; }
      .nav-links { display: none; }
      .nav-inner { flex-wrap: wrap; gap: 0.5rem; }
      .logo { font-size: 1rem; }
      .logo img { height: 32px; }
      
      .hero { padding: 2rem 1rem; }
      .hero h1 { font-size: 1.75rem; }
      .hero p { font-size: 0.9rem; }
      .hero-buttons { flex-direction: column; }
      .hero-buttons .btn { width: 100%; justify-content: center; }
      
      .stats-bar { padding: 1rem; }
      .stats-inner { grid-template-columns: repeat(2, 1fr); gap: 1rem; }
      .stat-value { font-size: 1.5rem; }
      
      .main { padding: 1rem; }
      
      .momentum-section { padding: 1.5rem; }
      .momentum-text h2 { font-size: 1.25rem; }
      .momentum-buttons { flex-direction: column; }
      .momentum-buttons .btn { width: 100%; justify-content: center; }
      
      .cta-grid { grid-template-columns: 1fr; }
      .cta-card { padding: 1.5rem; }
      
      .section-header { flex-direction: column; gap: 1rem; align-items: flex-start; }
      .filters { flex-direction: column; }
      .filter-input, .filter-select { width: 100%; min-width: unset; }
      
      .provider-grid { grid-template-columns: 1fr; }
      .provider-card { padding: 1rem; }
      .provider-stats { grid-template-columns: repeat(3, 1fr); gap: 0.5rem; }
      .provider-actions { flex-direction: column; }
      .provider-actions .btn { width: 100%; }
      
      .time-filters { flex-wrap: wrap; gap: 0.25rem; }
      .time-filter { padding: 0.25rem 0.5rem; font-size: 0.7rem; }
      
      .footer-inner { flex-direction: column; text-align: center; }
      .footer-links { flex-wrap: wrap; justify-content: center; }
    }

    /* Responsive - Small Mobile */
    @media (max-width: 380px) {
      .hero h1 { font-size: 1.5rem; }
      .stat-value { font-size: 1.25rem; }
      .btn { padding: 0.625rem 1rem; font-size: 0.875rem; }
    }

    /* Touch-friendly */
    @media (hover: none) {
      .provider-card:hover {
        transform: none;
      }
      .btn:active {
        transform: scale(0.98);
      }
    }

    /* Estimated badge */
    .badge-estimated {
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
      padding: 0.15rem 0.45rem;
      border-radius: 0.75rem;
      vertical-align: middle;
      margin-left: 0.25rem;
      cursor: help;
    }
    .badge-demo {
      display: inline-flex;
      align-items: center;
      gap: 0.2rem;
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.3px;
      background: rgba(139, 92, 246, 0.15);
      color: #a78bfa;
      padding: 0.15rem 0.45rem;
      border-radius: 0.75rem;
      vertical-align: middle;
      margin-left: 0.25rem;
    }

    /* Reduced motion */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* Dark mode (already dark, but ensure system preference respected) */
    @media (prefers-color-scheme: light) {
      /* Could add light mode styles here if needed */
    }
  </style>
</head>
<body>
  <!-- Navigation -->
  <nav class="nav">
    <div class="nav-inner">
      <a href="index.html" class="logo">
        <img src="images/arkeo-logo-200px_1.png" alt="Arkeo">
        <span class="logo-text">Arkeo <span>Marketplace</span></span>
      </a>
      <div class="nav-links">
        <a href="analytics.html" class="nav-link">üìä Analytics</a>
        <a href="https://racing.builtonarkeo.com/" target="_blank" class="nav-link">üèá Racing</a>
        <a href="https://docs.arkeo.network" target="_blank" class="nav-link">Docs</a>
        <a href="x402-setup.html" class="nav-link">‚ö° x402</a>
      </div>
      <div class="nav-buttons">
        <a href="my-contracts.html" class="nav-btn">My Contracts</a>
        <a href="become-provider.html" class="nav-btn">Provide Data</a>
        <a href="subscribe.html" class="nav-btn">Use Data</a>
        <a href="https://app.osmosis.zone/pool/2977" target="_blank" rel="noopener" class="nav-btn nav-btn-accent">Buy ARKEO</a>
      </div>
    </div>
  </nav>

  <!-- Hero Section -->
  <section class="hero">
    <h1>The Open Data Marketplace</h1>
    <p>You choose your provider. You set the terms. Direct on-chain contracts, no KYC, no signup ‚Äî just a wallet. Pay in USDC or ARKEO. Community owned, no VCs.</p>
  </section>

  <!-- Stats Bar -->
  <section class="stats-bar">
    <div class="stats-inner">
      <div class="stat">
        <div class="stat-value" id="providerCount">-</div>
        <div class="stat-label">Data Providers</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="serviceCount">-</div>
        <div class="stat-label">Supported Chains</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="contractCount">-</div>
        <div class="stat-label">Active Contracts</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="totalEarnings">-</div>
        <div class="stat-label">Total Bonded (ARKEO)</div>
      </div>
      <div class="stat">
        <div class="stat-value" id="totalContracts">-</div>
        <div class="stat-label">Total Contracts</div>
      </div>
    </div>
  </section>

  <!-- Main Content -->
  <main class="main">
    <!-- Providers Section -->
    <section>
      <div class="section-header">
        <h2 class="section-title">Active Providers</h2>
        <div style="display: flex; gap: 0.75rem; align-items: center;">
          <button class="view-toggle active" id="viewTable" onclick="setView('table')" title="Table View">‚ò∞</button>
          <button class="view-toggle" id="viewGrid" onclick="setView('grid')" title="Grid View">‚äû</button>
          <a href="become-provider.html" class="btn btn-secondary">+ Add Your Node</a>
        </div>
      </div>

      <!-- Enhanced Filter Bar -->
      <div class="filters" style="flex-wrap: wrap;">
        <input type="text" class="filter-input" id="searchInput" placeholder="üîç Search providers or chains..." oninput="filterProviders()" style="min-width: 250px;">
        <select class="filter-select" id="dataTypeFilter" onchange="filterProviders()">
          <option value="all">All Data Types</option>
          <option value="eth">Ethereum</option>
          <option value="btc">Bitcoin</option>
          <option value="gaia">Cosmos</option>
          <option value="thorchain">THORChain</option>
          <option value="osmosis">Osmosis</option>
        </select>
        <select class="filter-select" id="regionFilter" onchange="filterProviders()">
          <option value="all">All Regions</option>
          <option value="americas">Americas</option>
          <option value="europe">Europe</option>
          <option value="asia">Asia Pacific</option>
        </select>
        <select class="filter-select" id="statusFilter" onchange="filterProviders()">
          <option value="all">All Status</option>
          <option value="online">Online Only</option>
          <option value="offline">Offline</option>
        </select>
        <select class="filter-select" id="sortBy" onchange="filterProviders()">
          <option value="reputation">Reputation Score</option>
          <option value="earnings">Highest Earning</option>
          <option value="transactions">Most Transactions</option>
          <option value="rate">Lowest Rate</option>
          <option value="bond">Highest Bond</option>
        </select>
      </div>

      <div id="providersLoading" class="loading">
        <div class="spinner"></div>
        <p>Loading providers from Arkeo network...</p>
      </div>

      <!-- Table View -->
      <div class="provider-table-container" id="providerTableContainer">
        <table class="provider-table" id="providerTable">
          <thead>
            <tr>
              <th>Provider</th>
              <th>Reputation</th>
              <th>Data Types</th>
              <th>Region</th>
              <th title="Queries Per Minute ‚Äî from on-chain contract settings">QPM</th>
              <th>Status</th>
              <th title="Health checks use on-chain contract data. Active contracts prove a provider is serving data.">Health ‚ÑπÔ∏è</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="providerTableBody">
            <!-- Populated by JS -->
          </tbody>
        </table>
      </div>

      <!-- Grid View (hidden by default) -->
      <div class="provider-grid hidden" id="providerGrid"></div>
      
      <!-- Reputation info ‚Äî subtle collapsible at bottom of provider section -->
      <details style="margin-top: 0.75rem; padding: 0.5rem 0;">
        <summary style="cursor: pointer; color: var(--text-secondary); font-size: 1rem; list-style: none;">
          ‚ÑπÔ∏è How are reputation scores calculated?
        </summary>
        <div style="padding: 1rem 1.25rem; margin-top: 0.75rem; background: rgba(59, 224, 255, 0.05); border-radius: 0.5rem; font-size: 1rem; color: var(--text-dim);">
          <p style="margin-bottom: 0.5rem;"><strong>Calculated entirely from on-chain data ‚Äî no manual curation.</strong></p>
          <p style="margin: 0; line-height: 1.6;">
            35% Requests Served ¬∑ 25% Revenue Earned ¬∑ 20% Bond Committed ¬∑ 10% Active Contracts ¬∑ 10% Service Breadth. 
            Each metric scored 0-100 relative to the top provider, then weighted and summed.
          </p>
        </div>
      </details>
    </section>

    <!-- Market Rate Comparison -->
    <section class="momentum-section" style="margin-bottom: 2rem;">
      <div style="position: relative; z-index: 1;">
        <div class="momentum-badge">üìä Market Rate Comparison</div>
        <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 0.5rem;">How Does RPC Pricing Stack Up?</h2>
        <p style="color: var(--text-dim); margin-bottom: 1.5rem;">See what centralized and decentralized providers charge ‚Äî then compare with Arkeo's open marketplace.</p>
        
        <!-- Toggle between Centralized and Decentralized -->
        <div style="display: flex; gap: 0.5rem; margin-bottom: 1.5rem;">
          <button class="time-filter active" id="tabCentralized" onclick="showCompTab('centralized')">Centralized</button>
          <button class="time-filter" id="tabDecentralized" onclick="showCompTab('decentralized')">Decentralized</button>
          <button class="time-filter" id="tabAll" onclick="showCompTab('all')">All</button>
        </div>

        <!-- Comparison Table -->
        <div class="provider-table-container" style="border-radius: 0.75rem;">
          <table class="provider-table" id="compTable">
            <thead>
              <tr>
                <th>Provider</th>
                <th>Type</th>
                <th>Free Tier</th>
                <th>Cost per 1M Requests</th>
                <th>Cosmos</th>
                <th>THORChain</th>
                <th>KYC / Signup</th>
                <th>Key Advantage</th>
              </tr>
            </thead>
            <tbody id="compTableBody"></tbody>
          </table>
        </div>

        <!-- Arkeo Highlight -->
        <div style="margin-top: 1.5rem; padding: 1.25rem; background: rgba(59, 224, 255, 0.08); border: 1px solid rgba(59, 224, 255, 0.3); border-radius: 0.75rem; display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 1rem;">
          <div>
            <div style="font-weight: 700; font-size: 1.1rem; margin-bottom: 0.25rem;">
              <span style="color: var(--arkeo);">Arkeo</span> ‚Äî The Open Alternative
            </div>
            <div style="color: var(--text-dim); font-size: 0.9rem;">
              No signup. No KYC. No monthly plans. Pay per request with ARKEO tokens (25% discount) or USDC. The only marketplace with native THORChain & Cosmos support.
            </div>
          </div>
          <a href="subscribe.html" class="btn btn-primary" style="white-space: nowrap;">Try Arkeo Now ‚Üí</a>
        </div>

        <p style="color: var(--text-muted); font-size: 0.75rem; margin-top: 1rem;">
          * Pricing as of Feb 2026. Rates may vary by method complexity and volume. Per-request costs calculated from published plan pricing.
          <a href="https://github.com/rbechtold69/arkeo-data-engine-v2/issues" target="_blank" style="color: var(--arkeo);">Report outdated pricing ‚Üí</a>
        </p>
      </div>
    </section>

    <!-- Why Teams Choose Arkeo -->
    <section style="margin-bottom: 2rem;">
      <div style="text-align: center; margin-bottom: 2rem;">
        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">Why Teams Choose Arkeo</h2>
        <p style="color: var(--text-dim); max-width: 600px; margin: 0 auto;">An open marketplace built different ‚Äî by design, not marketing.</p>
      </div>
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.25rem;">

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üéØ</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">You Choose Your Provider</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">Not an algorithm. Direct contracts between you and your provider. No routing middleman deciding who handles your data.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîì</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">No Gatekeepers</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">No KYC, no email, no signup forms. Connect your wallet and go. Both providers and subscribers.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üí≥</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">Pay Your Way</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">USDC for predictable costs, or ARKEO tokens for a 25% discount. No forced token exposure.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üõ°Ô∏è</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">Censorship Resistant</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">No centralized entity can block providers or censor traffic. When Infura blocked Tornado Cash, decentralized marketplaces didn't.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üèõÔ∏è</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">Community Owned</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">No VC funding, no investor board. Built by and for the community. Decisions serve users, not shareholders.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">ü§ñ</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">AI Agent Ready</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">Agents can't fill out KYC forms or sign up for accounts. Arkeo's permissionless access is perfect for autonomous AI agents via x402.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid rgba(139,92,246,0.4); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='#8b5cf6'" onmouseout="this.style.borderColor='rgba(139,92,246,0.4)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚ö°</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">x402 Payments</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">HTTP-native micropayments. AI agents pay per request with USDC ‚Äî no accounts, no KYC, no contracts needed. Powered by <a href="https://x402.org" target="_blank" style="color: var(--arkeo);">Coinbase's x402 standard</a>.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">‚≠ê</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">On-Chain Reputation</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">Provider quality is measured by real usage data, not self-reported claims. Transparent, verifiable, no gatekeeping.</div>
        </div>

        <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 1rem; padding: 1.5rem; transition: border-color 0.2s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
          <div style="font-size: 1.5rem; margin-bottom: 0.5rem;">üîÑ</div>
          <div style="font-weight: 600; margin-bottom: 0.5rem;">Auto-Failover</div>
          <div style="color: var(--text-dim); font-size: 0.9rem;">Your traffic automatically routes to backup providers if your primary goes down. No manual switching.</div>
        </div>

      </div>
    </section>

    <!-- Try x402 Live Demo -->
    <section style="margin-bottom: 2rem;">
      <div style="text-align: center; margin-bottom: 2rem;">
        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">‚ö° Try x402 Live</h2>
        <p style="color: var(--text-dim); max-width: 600px; margin: 0 auto;">See HTTP-native payments in action</p>
      </div>
      <div style="max-width: 800px; margin: 0 auto;">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <button id="x402DemoBtn" onclick="tryX402Demo()" class="btn btn-primary" style="font-size: 1.1rem; padding: 0.875rem 2rem;">
            üöÄ Send Request
          </button>
        </div>
        <div id="x402Response" class="hidden">
          <div id="x402StatusBadge" style="margin-bottom: 1rem; text-align: center;">
            <span style="display: inline-block; background: rgba(245,158,11,0.15); color: #f59e0b; padding: 0.5rem 1.25rem; border-radius: 2rem; font-weight: 700; font-size: 1rem;">HTTP 402 ‚Äî Payment Required</span>
          </div>
          <div id="x402CorsNote" class="hidden" style="background: rgba(245,158,11,0.1); border: 1px solid rgba(245,158,11,0.3); border-radius: 0.75rem; padding: 0.75rem 1rem; margin-bottom: 1rem; font-size: 0.85rem; color: #f59e0b; text-align: center;">
            ‚ö†Ô∏è Live demo blocked by browser security (CORS). Here's the actual response you'd get.
          </div>
          <!-- Key Fields -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <div style="font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px;">Price per Request</div>
              <div style="font-size: 1.5rem; font-weight: 700; color: var(--arkeo); margin-top: 0.25rem;">$0.0001</div>
              <div style="font-size: 0.7rem; color: var(--text-dim);">USDC on Base</div>
            </div>
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <div style="font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px;">Network</div>
              <div style="font-size: 1.5rem; font-weight: 700; color: var(--arkeo); margin-top: 0.25rem;">eip155:8453</div>
              <div style="font-size: 0.7rem; color: var(--text-dim);">Base Mainnet</div>
            </div>
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem; text-align: center;">
              <div style="font-size: 0.75rem; color: var(--text-dim); text-transform: uppercase; letter-spacing: 0.5px;">Pay To</div>
              <div style="font-size: 0.85rem; font-weight: 600; color: var(--arkeo); margin-top: 0.25rem; word-break: break-all;">0xd5e0fAA9...Bc54E61</div>
              <div style="font-size: 0.7rem; color: var(--text-dim);">Arkeo Provider</div>
            </div>
          </div>
          <!-- JSON Response -->
          <div style="position: relative; margin-bottom: 1rem;">
            <div style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.5rem; font-weight: 600;">Decoded PAYMENT-REQUIRED Header:</div>
            <pre id="x402Json" style="background: #0d1117; border: 1px solid var(--border); border-radius: 0.75rem; padding: 1.25rem; overflow-x: auto; font-size: 0.8rem; line-height: 1.5; color: #e6edf3; margin: 0;"></pre>
          </div>
          <!-- Curl command -->
          <div style="position: relative; margin-bottom: 1.5rem;">
            <div style="font-size: 0.8rem; color: var(--text-dim); margin-bottom: 0.5rem; font-weight: 600;">Try it yourself:</div>
            <div style="background: #0d1117; border: 1px solid var(--border); border-radius: 0.75rem; padding: 1rem; display: flex; align-items: center; justify-content: space-between; gap: 1rem;">
              <code style="color: #79c0ff; font-size: 0.85rem; white-space: nowrap; overflow-x: auto;">curl -v https://red5-arkeo.duckdns.org/</code>
              <button onclick="navigator.clipboard.writeText('curl -v https://red5-arkeo.duckdns.org/'); this.textContent='‚úì Copied'; setTimeout(()=>this.textContent='üìã Copy',1500)" class="btn btn-secondary" style="padding: 0.375rem 0.75rem; font-size: 0.75rem; white-space: nowrap;">üìã Copy</button>
            </div>
          </div>
          <!-- Explanation -->
          <div style="background: rgba(59,224,255,0.05); border: 1px solid rgba(59,224,255,0.2); border-radius: 0.75rem; padding: 1.25rem; margin-bottom: 1.5rem;">
            <p style="color: var(--text-dim); font-size: 0.9rem; margin-bottom: 0.75rem;">This is a <strong style="color: var(--text);">real x402 response</strong> from an Arkeo provider. Any x402-compatible client or AI agent can read these payment instructions, sign a USDC payment, and get data back automatically.</p>
            <p style="color: var(--arkeo); font-weight: 600; font-size: 0.95rem;">No accounts. No API keys. Just HTTP.</p>
          </div>
          <!-- CTAs -->
          <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
            <a href="x402-setup.html" class="btn btn-primary">Set Up x402 on Your Node ‚Üí</a>
            <a href="https://x402.org" target="_blank" class="btn btn-outline">Learn More at x402.org ‚Üí</a>
          </div>
        </div>
      </div>
    </section>

    <script>
    function tryX402Demo() {
      const btn = document.getElementById('x402DemoBtn');
      const resp = document.getElementById('x402Response');
      const corsNote = document.getElementById('x402CorsNote');
      const jsonPre = document.getElementById('x402Json');
      
      btn.disabled = true;
      btn.innerHTML = '<div class="spinner" style="width:20px;height:20px;border-width:2px;margin:0 auto;"></div> Sending...';
      
      const hardcodedB64 = 'eyJ4NDAyVmVyc2lvbiI6MiwiZXJyb3IiOiJQYXltZW50IHJlcXVpcmVkIiwicmVzb3VyY2UiOnsidXJsIjoiaHR0cDovLzE2MS4zNS45Ny4yMTU6MzYzNy8iLCJkZXNjcmlwdGlvbiI6IkFya2VvIFJQQyBEYXRhIFByb3ZpZGVyIC0gcGF5LXBlci1yZXF1ZXN0IGFjY2VzcyIsIm1pbWVUeXBlIjoiYXBwbGljYXRpb24vanNvbiJ9LCJhY2NlcHRzIjpbeyJzY2hlbWUiOiJleGFjdCIsIm5ldHdvcmsiOiJlaXAxNTU6ODQ1MyIsImFtb3VudCI6IjEwMCIsImFzc2V0IjoiMHg4MzM1ODlmQ0Q2ZURiNkUwOGY0YzdDMzJENGY3MWI1NGJkQTAyOTEzIiwicGF5VG8iOiIweGQ1ZTBmQUE5OTA1YjkxQjliODlmMTcwM0MxQzIyODEyMEJjNTRFNjEiLCJtYXhUaW1lb3V0U2Vjb25kcyI6MzAwLCJleHRyYSI6eyJuYW1lIjoiVVNEIENvaW4iLCJ2ZXJzaW9uIjoiMiJ9fV19';
      
      function showResponse(usedCors) {
        const decoded = JSON.parse(atob(hardcodedB64));
        jsonPre.textContent = JSON.stringify(decoded, null, 2);
        if (usedCors) corsNote.classList.remove('hidden');
        resp.classList.remove('hidden');
        btn.disabled = false;
        btn.innerHTML = 'üöÄ Send Request';
      }
      
      setTimeout(() => {
        fetch('https://red5-arkeo.duckdns.org/', { mode: 'cors' })
          .then(r => { showResponse(false); })
          .catch(e => { showResponse(true); });
      }, 800);
    }
    </script>

    <!-- Tokenomics Flywheel -->
    <section style="margin-bottom: 2rem;">
      <div style="text-align: center; margin-bottom: 2.5rem;">
        <div class="momentum-badge">üî• Tokenomics</div>
        <h2 style="font-size: 1.75rem; font-weight: 700; margin-bottom: 0.5rem;">How ARKEO Captures Value</h2>
        <p style="color: var(--text-dim); max-width: 600px; margin: 0 auto;">Every transaction strengthens the network. A self-reinforcing flywheel that rewards participants. 2% burn proposed ‚Äî subject to DAO governance vote.</p>
      </div>

      <!-- Flywheel Diagram -->
      <div style="position: relative; max-width: 700px; margin: 0 auto 2.5rem;">
        <div style="position: relative; width: 100%; aspect-ratio: 1; max-width: 700px;">
          <!-- Center glow -->
          <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 140px; height: 140px; border-radius: 50%; background: radial-gradient(circle, rgba(59,224,255,0.15), transparent 70%); display: flex; align-items: center; justify-content: center; flex-direction: column; z-index: 2;">
            <div style="font-size: 2rem;">‚ôæÔ∏è</div>
            <div style="font-size: 0.7rem; color: var(--arkeo); font-weight: 700; text-transform: uppercase; letter-spacing: 1px;">Flywheel</div>
          </div>
          <!-- Circular ring -->
          <svg viewBox="0 0 700 700" style="position: absolute; inset: 0; width: 100%; height: 100%;">
            <defs>
              <marker id="arrowhead" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                <polygon points="0 0, 8 3, 0 6" fill="#3BE0FF" opacity="0.6"/>
              </marker>
            </defs>
            <!-- Circular path arrows -->
            <circle cx="350" cy="350" r="230" fill="none" stroke="rgba(59,224,255,0.12)" stroke-width="2" stroke-dasharray="8 12"/>
            <!-- Animated dashes rotating -->
            <circle cx="350" cy="350" r="230" fill="none" stroke="rgba(59,224,255,0.3)" stroke-width="2" stroke-dasharray="30 200" stroke-dashoffset="0">
              <animateTransform attributeName="transform" type="rotate" from="0 350 350" to="360 350 350" dur="20s" repeatCount="indefinite"/>
            </circle>
            <!-- Arrow segments between nodes -->
            <path d="M 465 145 Q 540 200 530 290" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
            <path d="M 545 370 Q 540 470 470 530" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
            <path d="M 420 570 Q 350 590 270 560" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
            <path d="M 210 520 Q 150 450 145 370" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
            <path d="M 155 290 Q 170 200 240 145" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
            <path d="M 300 120 Q 350 105 410 120" fill="none" stroke="rgba(59,224,255,0.4)" stroke-width="1.5" marker-end="url(#arrowhead)"/>
          </svg>
          <!-- Step nodes positioned around the circle -->
          <!-- Step 1: Top center -->
          <div style="position: absolute; top: 2%; left: 50%; transform: translateX(-50%); width: 150px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üí≥</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">Users Pay for Data</div>
              <div style="font-size: 0.65rem; color: var(--text-dim); margin-top: 0.15rem;">USDC or ARKEO</div>
            </div>
          </div>
          <!-- Step 2: Top right -->
          <div style="position: absolute; top: 15%; right: 3%; width: 150px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='#f59e0b'" onmouseout="this.style.borderColor='var(--border)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üîÑ</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">USDC Auto-Converts</div>
              <div style="font-size: 0.65rem; color: #f59e0b; margin-top: 0.15rem;">Buy pressure</div>
            </div>
          </div>
          <!-- Step 3: Bottom right -->
          <div style="position: absolute; top: 52%; right: 0%; width: 150px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid rgba(249,115,22,0.4); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='#f97316'" onmouseout="this.style.borderColor='rgba(249,115,22,0.4)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üî•</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">2% Burn <span style="font-size: 0.6rem; background: rgba(249,115,22,0.2); color: #f97316; padding: 0.1rem 0.4rem; border-radius: 0.25rem; font-weight: 600; vertical-align: middle;">COMING SOON</span></div>
              <div style="font-size: 0.65rem; color: #f97316; margin-top: 0.15rem;">Subject to DAO vote</div>
            </div>
          </div>
          <!-- Step 4: Bottom -->
          <div style="position: absolute; bottom: 5%; right: 15%; width: 150px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üîí</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">Providers Bond ARKEO</div>
              <div style="font-size: 0.65rem; color: var(--text-dim); margin-top: 0.15rem;">Supply locked</div>
            </div>
          </div>
          <!-- Step 5: Bottom left -->
          <div style="position: absolute; bottom: 5%; left: 8%; width: 160px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid rgba(16,185,129,0.4); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='#10b981'" onmouseout="this.style.borderColor='rgba(16,185,129,0.4)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üìà</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">Less Supply + More Demand</div>
              <div style="font-size: 0.65rem; color: #10b981; margin-top: 0.15rem;">Price appreciation</div>
            </div>
          </div>
          <!-- Step 6: Top left -->
          <div style="position: absolute; top: 15%; left: 3%; width: 150px; text-align: center;">
            <div style="background: var(--bg-card); border: 1px solid var(--border); border-radius: 0.75rem; padding: 0.75rem 0.5rem; transition: border-color 0.3s;" onmouseover="this.style.borderColor='var(--arkeo)'" onmouseout="this.style.borderColor='var(--border)'">
              <div style="font-size: 1.25rem; margin-bottom: 0.25rem;">üß≤</div>
              <div style="font-size: 0.75rem; font-weight: 600; line-height: 1.3;">Attracts More Providers</div>
              <div style="font-size: 0.65rem; color: var(--text-dim); margin-top: 0.15rem;">Higher token value</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Key Stats Boxes -->
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; max-width: 900px; margin: 0 auto;">
        <div style="background: var(--bg-card); border: 1px solid rgba(249,115,22,0.3); border-radius: 0.75rem; padding: 1.25rem; text-align: center;">
          <div style="font-size: 1.75rem; font-weight: 700; color: #f97316;" id="flywheelBurned">Proposed</div>
          <div style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem;">üî• ARKEO Burn ‚Äî DAO Vote Required</div>
        </div>
        <div style="background: var(--bg-card); border: 1px solid rgba(59,224,255,0.3); border-radius: 0.75rem; padding: 1.25rem; text-align: center;">
          <div style="font-size: 1.75rem; font-weight: 700; color: var(--arkeo);" id="flywheelBonded">‚Äî</div>
          <div style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem;">üîí Total Bonded</div>
        </div>
        <div style="background: var(--bg-card); border: 1px solid rgba(16,185,129,0.3); border-radius: 0.75rem; padding: 1.25rem; text-align: center;">
          <div style="font-size: 1.75rem; font-weight: 700; color: #10b981;">25%</div>
          <div style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem;">üíé ARKEO Discount</div>
        </div>
        <div style="background: var(--bg-card); border: 1px solid rgba(245,158,11,0.3); border-radius: 0.75rem; padding: 1.25rem; text-align: center;">
          <div style="font-size: 1.25rem; font-weight: 700; color: #f59e0b;">USDC ‚Üí ARKEO</div>
          <div style="font-size: 0.8rem; color: var(--text-dim); margin-top: 0.25rem;">üîÑ Auto-Convert</div>
        </div>
      </div>
    </section>

  </main>

  <!-- Racing Section -->
  <section class="racing-section" style="max-width: 1400px; margin: 0 auto 2rem; padding: 2rem;">
    <div class="racing-content">
      <div class="racing-visual">
        <div class="race-track">
          <div class="horse" style="--delay: 0s; --speed: 2.1s;">üèá</div>
          <div class="horse" style="--delay: 0.3s; --speed: 2.4s;">üèá</div>
          <div class="horse" style="--delay: 0.1s; --speed: 2.2s;">üèá</div>
        </div>
      </div>
      <div class="racing-text">
        <div class="momentum-badge" style="background: linear-gradient(135deg, rgba(59, 224, 255, 0.15), rgba(43, 184, 212, 0.15)); border-color: var(--arkeo);">
          üèá Arkeo Racing
        </div>
        <h2>Watch Providers Compete in Real-Time</h2>
        <p>Every provider is a racehorse. Live probes measure latency, uptime, and reliability ‚Äî turning performance into a competition.</p>
        <ul style="margin: 1rem 0; padding-left: 1.5rem; color: var(--text-dim);">
          <li>üîç Real-time latency tracking</li>
          <li>üèÜ Leaderboards by performance</li>
          <li>‚ö° Pick winners, compete with others</li>
          <li>üìä See which providers are truly reliable</li>
        </ul>
        <a href="https://racing.builtonarkeo.com/" target="_blank" class="btn btn-primary" style="background: linear-gradient(135deg, #3be0ff, #2bb8d4);">
          üèá Enter the Race
        </a>
      </div>
    </div>
  </section>

  <!-- Footer CTA -->
  <section style="background: linear-gradient(135deg, rgba(59, 224, 255, 0.1), rgba(245, 158, 11, 0.1)); padding: 3rem 2rem; text-align: center; border-top: 1px solid var(--border);">
    <h2 style="font-size: 1.75rem; margin-bottom: 0.5rem;">Ready to join the decentralized data revolution?</h2>
    <p style="color: var(--text-dim); margin-bottom: 1.5rem;">Get ARKEO tokens to access the marketplace or become a provider.</p>
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
      <a href="https://app.osmosis.zone/pool/2977" target="_blank" rel="noopener" class="btn btn-buy" style="font-size: 1.1rem; padding: 0.875rem 2rem;">üíé Buy ARKEO on Osmosis</a>
      <a href="become-provider.html" class="btn btn-primary" style="font-size: 1.1rem; padding: 0.875rem 2rem;">üöÄ Start Earning</a>
    </div>
  </section>

  <!-- Footer -->
  <footer class="footer">
    <div class="footer-inner">
      <div style="color: var(--text-dim); font-size: 0.875rem;">
        ¬© 2026 Arkeo Network. Decentralized data infrastructure.
      </div>
      <div class="footer-links">
        <a href="https://app.osmosis.zone/pool/2977" target="_blank" class="footer-link" style="color: #f59e0b;">üíé Buy ARKEO</a>
        <a href="https://docs.arkeo.network" target="_blank" class="footer-link">Docs</a>
        <a href="agents.html" class="footer-link">AI Agents</a>
      </div>
      <div style="display: flex; gap: 1rem; align-items: center;">
        <a href="https://discord.gg/f3cKq2bPPF" target="_blank" title="Discord" style="color: var(--text-dim); transition: color 0.2s;" onmouseover="this.style.color='#5865F2'" onmouseout="this.style.color='var(--text-dim)'">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.956 2.418-2.157 2.418zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419 0-1.333.956-2.419 2.157-2.419 1.21 0 2.176 1.096 2.157 2.42 0 1.333-.946 2.418-2.157 2.418z"/></svg>
        </a>
        <a href="https://x.com/ArkeoNetwork" target="_blank" title="X (Twitter)" style="color: var(--text-dim); transition: color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='var(--text-dim)'">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
        </a>
        <a href="https://github.com/arkeonetwork" target="_blank" title="GitHub" style="color: var(--text-dim); transition: color 0.2s;" onmouseover="this.style.color='#fff'" onmouseout="this.style.color='var(--text-dim)'">
          <svg width="21" height="21" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
        </a>
      </div>
    </div>
  </footer>

  <script src="js/providers.js"></script>
  <script>
    // ============================================================
    // CONFIG is loaded from js/config.js
    // Utils are loaded from js/utils.js
    // ============================================================

    // ============================================================
    // STATE
    // ============================================================
    let state = {
      providers: [],        // Raw provider entries from blockchain
      providerInfos: {},    // Aggregated provider info by pubkey (with metadata)
      services: {},         // Service ID -> service info lookup
      contracts: [],
      contractsByProvider: {}, // pubkey -> count of active contracts
      reputationScores: {}, // pubkey -> { total, requests, revenue, bond, contracts, services, breakdown }
      timeRange: 'all_time',
      chart: null,
    };

    // ============================================================
    // LOAD DATA FROM BLOCKCHAIN
    // ============================================================
    async function loadData() {
      const loadingEl = document.getElementById('providersLoading');
      
      try {
        // Load providers, services, and contracts in parallel with caching
        const [providers, services, contracts] = await Promise.all([
          API.getProviders(),
          API.getServices(),
          API.getContracts().catch(() => []), // Contracts optional
        ]);

        state.providers = providers;
        state.contracts = contracts;
        
        // Fetch current block height for contract expiry checks
        try {
          const statusResp = await fetch('https://rpc-seed.arkeo.network/status');
          const statusData = await statusResp.json();
          state.currentHeight = parseInt(statusData.result?.sync_info?.latest_block_height || '0');
        } catch (e) { state.currentHeight = 0; }
        
        // Count ACTIVE contracts per provider (non-expired with remaining deposit)
        // Also track QPM (queries_per_minute) per provider from contracts
        state.contractsByProvider = {};
        state.qpmByProvider = {};
        contracts.forEach(c => {
          const pk = c.provider;
          const deposit = parseInt(c.deposit || 0);
          const paid = parseInt(c.paid || 0);
          const expiry = parseInt(c.height || 0) + parseInt(c.duration || 0);
          const isActive = expiry > state.currentHeight && deposit > paid;
          if (pk && isActive) {
            state.contractsByProvider[pk] = (state.contractsByProvider[pk] || 0) + 1;
          }
          // Track QPM from contract data
          const qpm = parseInt(c.queries_per_minute || c.queriesPerMinute || 0);
          if (pk && qpm > 0) {
            if (!state.qpmByProvider[pk]) state.qpmByProvider[pk] = [];
            state.qpmByProvider[pk].push(qpm);
          }
        });
        
        // Build services lookup map
        state.services = {};
        services.forEach(s => {
          state.services[s.service_id] = s;
        });

        // Aggregate providers by pubkey and fetch metadata
        await aggregateProviders();

        // Calculate reputation scores after all data is loaded
        calculateReputationScores();

        // Show all ONLINE providers (verified ones highlighted, new providers auto-included)
        // Determine which providers have active (non-expired) contracts
        const currentHeight = state.currentHeight || 0;
        const activeProviderKeys = new Set();
        state.contracts.forEach(c => {
          const expiry = parseInt(c.height || 0) + parseInt(c.duration || 0);
          if (expiry > currentHeight) activeProviderKeys.add(c.provider);
        });

        // Filter to show only legitimate, active providers:
        // 1. Must be ONLINE with bond > 0
        // 2. Must NOT have localhost/127.0.0.1 metadata
        // 3. Must be in KNOWN_PROVIDERS OR have a metadata URI
        const onlineProviders = Object.values(state.providerInfos).filter(p => {
          if (p.status !== 'ONLINE' || p.totalBond < parseInt(CONFIG.MIN_BOND)) return false;
          const uri = p.metadataUri || '';
          if (uri.includes('127.0.0.1') || uri.includes('localhost')) return false;
          const isKnown = !!findKnown(p.pubkey);
          // Show if: in KNOWN_PROVIDERS, has metadata URI, or has any PAYG rate set
          if (!isKnown && (!uri || uri.trim() === '') && !(p.paygRates && Object.keys(p.paygRates).length > 0)) return false;
          return true;
        });
        
        // Sort by reputation by default
        // Sort: healthy first, then by reputation
        onlineProviders.sort((a, b) => {
          const aHealth = (KNOWN_PROVIDERS[a.pubkey]?.health === 'healthy') ? 1 : 0;
          const bHealth = (KNOWN_PROVIDERS[b.pubkey]?.health === 'healthy') ? 1 : 0;
          if (bHealth !== aHealth) return bHealth - aHealth;
          return (state.reputationScores[b.pubkey]?.total || 0) - (state.reputationScores[a.pubkey]?.total || 0);
        });

        // Update UI
        updateStats();
        renderProviders(onlineProviders, 5); // Show top 5 on homepage
        renderEarningsChart();

        // Live health check ‚Äî ping metadata endpoints in background
        runLiveHealthChecks(onlineProviders);

        // Show success briefly
        if (CONFIG.DEBUG_MODE) {
          console.log('Data loaded:', { 
            providers: state.providers.length, 
            providerInfos: Object.keys(state.providerInfos).length,
            services: Object.keys(state.services).length,
            contracts: state.contracts.length 
          });
        }

      } catch (err) {
        ErrorHandler.handle(err, 'loadData');
        
        // Try to show cached data if available
        const cachedProviders = Cache.get('providerInfos');
        if (cachedProviders) {
          state.providerInfos = cachedProviders;
          updateStats();
          renderProviders(Object.values(state.providerInfos).filter(p => p.totalBond >= parseInt(CONFIG.MIN_BOND)));
          renderEarningsChart();
          ErrorHandler.showToast('Showing cached data. Live data unavailable.', 'warning');
        } else {
          loadingEl.innerHTML = `
            <p style="color: var(--error);">
              Failed to load providers. 
              <button onclick="loadData()" style="color: var(--arkeo); background: none; border: none; cursor: pointer; text-decoration: underline;">
                Try again
              </button>
            </p>
          `;
        }
      }
    }
    
    // Aggregate provider entries by pubkey and fetch metadata
    async function aggregateProviders() {
      state.providerInfos = {};
      
      // Group by pubkey
      state.providers.forEach(p => {
        const pubkey = p.pub_key;
        if (!pubkey) return;
        
        if (!state.providerInfos[pubkey]) {
          state.providerInfos[pubkey] = {
            pubkey: pubkey,
            name: null, // Will be fetched from metadata
            description: null,
            website: null,
            location: null,
            services: [],
            totalBond: 0,
            status: 'OFFLINE',
            metadataUri: p.metadata_uri,
            lastUpdate: 0,
          };
        }
        
        const info = state.providerInfos[pubkey];
        info.totalBond += parseInt(p.bond || 0);
        if (p.status === 'ONLINE') info.status = 'ONLINE';
        info.metadataUri = info.metadataUri || p.metadata_uri;
        // Track most recent update across all service entries
        const lu = parseInt(p.last_update || 0);
        if (lu > info.lastUpdate) info.lastUpdate = lu;
        
        // Add service info
        const serviceName = getServiceName(p.service);
        info.services.push({
          id: p.service,
          name: serviceName,
          bond: parseInt(p.bond || 0),
          rate: p.pay_as_you_go_rate?.[0]?.amount || '0',
          status: p.status,
        });
      });
      
      // Apply known provider metadata (to avoid CORS issues in browser)
      applyKnownProviderMetadata();
      
      // Try to fetch any additional metadata (may fail due to CORS)
      const pubkeys = Object.keys(state.providerInfos);
      const unknownProviders = pubkeys.filter(pk => !state.providerInfos[pk].verified);
      const metadataPromises = unknownProviders.map(pk => fetchProviderMetadata(pk));
      await Promise.allSettled(metadataPromises);
      
      // Cache the aggregated data
      Cache.set('providerInfos', state.providerInfos);
    }
    
    // KNOWN_PROVIDERS loaded from js/providers.js (included via script tag)
    
    // Helper to find known provider by pubkey (handles prefix matching)
    function findKnown(pk) {
      if (typeof KNOWN_PROVIDERS === 'undefined') return null;
      if (KNOWN_PROVIDERS[pk]) return KNOWN_PROVIDERS[pk];
      const match = Object.keys(KNOWN_PROVIDERS).find(k =>
        k.startsWith(pk.slice(0, 40)) || pk.startsWith(k.slice(0, 40)));
      return match ? KNOWN_PROVIDERS[match] : null;
    }

    // Apply known provider metadata
    function applyKnownProviderMetadata() {
      Object.entries(KNOWN_PROVIDERS).forEach(([pubkey, meta]) => {
        // Find matching provider (pubkey might be truncated in our data)
        const matchingKey = Object.keys(state.providerInfos).find(pk => 
          pk === pubkey || pubkey.startsWith(pk) || pk.startsWith(pubkey.slice(0, 40))
        );
        
        if (matchingKey && state.providerInfos[matchingKey]) {
          const info = state.providerInfos[matchingKey];
          info.name = meta.name;
          info.description = meta.description;
          info.website = meta.website;
          info.location = meta.location;
          info.verified = true;
        }
      });
    }

    // Fetch metadata from provider's metadata_uri
    async function fetchProviderMetadata(pubkey) {
      const info = state.providerInfos[pubkey];
      if (!info) return;
      
      // All ONLINE providers are shown ‚Äî no gatekeeping
      // Generate a useful display name from available data
      if (!info.name) {
        // Try to use their top service as a name hint
        const topService = info.services?.[0]?.name;
        if (topService && topService !== 'Service 0') {
          // Capitalize and clean up service name for display
          const cleanName = topService.split('-').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
          info.name = cleanName + ' Provider';
        } else {
          info.name = 'Provider ' + pubkey.slice(-8);
        }
      }
      
      // Mark as verified if in KNOWN_PROVIDERS (exact or prefix match)
      info.verified = !!findKnown(pubkey);
      
      if (!info.metadataUri) return;
      
      // Skip localhost URIs
      if (info.metadataUri.includes('127.0.0.1') || info.metadataUri.includes('localhost')) {
        return;
      }
      
      try {
        const response = await fetch(info.metadataUri, { 
          signal: AbortSignal.timeout(5000) // 5 second timeout
        });
        
        if (response.ok) {
          const metadata = await response.json();
          const moniker = metadata.config?.moniker || metadata.moniker;
          
          if (moniker && moniker.length > 0) {
            info.name = moniker;
            info.description = metadata.config?.description || metadata.description || '';
            info.website = metadata.config?.website || metadata.website || '';
            info.location = metadata.config?.location || metadata.location || '';
            info.verified = true; // Metadata accessible = verified
          }
        }
      } catch (err) {
        if (CONFIG.DEBUG_MODE) {
          console.warn('Failed to fetch metadata for', pubkey, err.message);
        }
      }
    }
    
    // Auto-refresh data periodically
    function startAutoRefresh() {
      setInterval(() => {
        if (document.visibilityState === 'visible') {
          // Clear cache and reload
          Cache.remove('providers');
          Cache.remove('services');
          Cache.remove('contracts');
          loadData();
        }
      }, CONFIG.REFRESH_INTERVAL_MS);
    }

    // ============================================================
    // REPUTATION SCORE CALCULATION
    // ============================================================
    function calculateReputationScores() {
      state.reputationScores = {};
      const providers = Object.values(state.providerInfos);
      if (providers.length === 0) return;

      // Aggregate per-provider metrics from contracts
      const metrics = {};
      providers.forEach(p => {
        const pk = p.pubkey;
        metrics[pk] = {
          totalNonce: 0,
          totalPaid: 0,
          bond: p.totalBond || 0,
          activeContracts: 0,
          serviceCount: p.services?.length || 0,
        };
      });

      state.contracts.forEach(c => {
        const pk = c.provider;
        if (!metrics[pk]) return;
        metrics[pk].totalNonce += parseInt(c.nonce || 0);
        metrics[pk].totalPaid += parseInt(c.paid || 0);
        const deposit = parseInt(c.deposit || 0);
        const paid = parseInt(c.paid || 0);
        if (deposit > paid) metrics[pk].activeContracts++;
      });

      // Find maximums for normalization
      const maxNonce = Math.max(1, ...Object.values(metrics).map(m => m.totalNonce));
      const maxPaid = Math.max(1, ...Object.values(metrics).map(m => m.totalPaid));
      const maxBond = Math.max(1, ...Object.values(metrics).map(m => m.bond));
      const maxContracts = Math.max(1, ...Object.values(metrics).map(m => m.activeContracts));
      const maxServices = Math.max(1, ...Object.values(metrics).map(m => m.serviceCount));

      // Calculate weighted score for each provider
      Object.entries(metrics).forEach(([pk, m]) => {
        const reqScore = (m.totalNonce / maxNonce) * 100;
        const revScore = (m.totalPaid / maxPaid) * 100;
        const bondScore = (m.bond / maxBond) * 100;
        const contractScore = (m.activeContracts / maxContracts) * 100;
        const serviceScore = (m.serviceCount / maxServices) * 100;

        const total = Math.round(
          reqScore * 0.35 +
          revScore * 0.25 +
          bondScore * 0.20 +
          contractScore * 0.10 +
          serviceScore * 0.10
        );

        state.reputationScores[pk] = {
          total: total,
          requests: Math.round(reqScore),
          revenue: Math.round(revScore),
          bond: Math.round(bondScore),
          contracts: Math.round(contractScore),
          services: Math.round(serviceScore),
        };
      });
    }

    function getReputationBadge(score) {
      if (score >= 80) return 'üèÜ';
      if (score >= 60) return 'ü•à';
      if (score >= 40) return 'ü•â';
      return '';
    }

    function getReputationClass(score) {
      if (score >= 80) return 'rep-gold';
      if (score >= 60) return 'rep-silver';
      if (score >= 40) return 'rep-bronze';
      return 'rep-none';
    }

    function reputationTooltip(pk) {
      const s = state.reputationScores[pk];
      if (!s) return '';
      return `Requests: ${s.requests} | Revenue: ${s.revenue} | Bond: ${s.bond} | Contracts: ${s.contracts} | Services: ${s.services}`;
    }

    function updateStats() {
      const currentHeight = state.currentHeight || 0;

      // Use same filter as provider listing
      const visibleProviders = Object.values(state.providerInfos).filter(p => {
        if (p.status !== 'ONLINE' || p.totalBond < parseInt(CONFIG.MIN_BOND)) return false;
        const uri = p.metadataUri || '';
        if (uri.includes('127.0.0.1') || uri.includes('localhost')) return false;
        const isKnown = !!findKnown(p.pubkey);
        if (!isKnown && (!uri || uri.trim() === '')) return false;
        return true;
      });
      document.getElementById('providerCount').textContent = visibleProviders.length;

      // Count unique chains/services from visible providers only
      const visiblePubkeys = new Set(visibleProviders.map(p => p.pubkey));
      const visibleServices = new Set();
      state.providers.forEach(p => {
        if (visiblePubkeys.has(p.pub_key)) visibleServices.add(p.service);
      });
      document.getElementById('serviceCount').textContent = visibleServices.size;

      // Active contracts (non-expired)
      const activeContracts = state.contracts.filter(c => 
        parseInt(c.height || 0) + parseInt(c.duration || 0) > currentHeight
      );
      document.getElementById('contractCount').textContent = activeContracts.length;

      // Total bond from visible providers only
      let totalBond = 0;
      visibleProviders.forEach(p => { totalBond += (p.totalBond || 0); });
      document.getElementById('totalEarnings').textContent = formatArkeo(totalBond);

      // Total contracts ever opened
      const totalContractsEl = document.getElementById('totalContracts');
      if (totalContractsEl) totalContractsEl.textContent = state.contracts.length || '0';

      // Sync flywheel stats
      const flywheelBonded = document.getElementById('flywheelBonded');
      if (flywheelBonded) flywheelBonded.textContent = formatArkeo(totalBond);
    }

    function formatArkeo(uarkeo, decimals = 2) {
      // Use utility if available, fallback to local
      if (typeof Format !== 'undefined') {
        return Format.arkeo(uarkeo, decimals);
      }
      const val = parseInt(uarkeo || 0) / CONFIG.ARKEO_DIVISOR;
      if (val >= 1000000) return (val / 1000000).toFixed(1) + 'M';
      if (val >= 1000) return (val / 1000).toFixed(1) + 'K';
      return val.toFixed(decimals);
    }

    function getServiceName(serviceId) {
      const service = state.services[serviceId];
      if (service) return service.name;
      return `Service ${serviceId}`;
    }

    let currentView = 'table'; // 'table' or 'grid'
    
    function setView(view) {
      currentView = view;
      document.getElementById('viewTable').classList.toggle('active', view === 'table');
      document.getElementById('viewGrid').classList.toggle('active', view === 'grid');
      document.getElementById('providerTableContainer').classList.toggle('hidden', view !== 'table');
      document.getElementById('providerGrid').classList.toggle('hidden', view !== 'grid');
    }
    
    function getProviderQpm(pubkey) {
      const qpmValues = state.qpmByProvider?.[pubkey];
      if (!qpmValues || qpmValues.length === 0) return '‚Äî';
      // Show the typical (median) QPM across their contracts
      const sorted = [...qpmValues].sort((a, b) => a - b);
      const median = sorted[Math.floor(sorted.length / 2)];
      return median.toLocaleString();
    }

    let showAllProviders = false;
    
    function toggleShowAll() {
      showAllProviders = !showAllProviders;
      filterProviders();
    }
    
    function renderProviders(providers, limit = null) {
      const grid = document.getElementById('providerGrid');
      const tableBody = document.getElementById('providerTableBody');
      const loading = document.getElementById('providersLoading');
      
      loading.classList.add('hidden');
      loading.style.display = 'none';

      if (providers.length === 0) {
        const emptyMsg = '<p style="color: var(--text-dim); text-align: center; padding: 2rem;">No providers found.</p>';
        grid.innerHTML = emptyMsg;
        tableBody.innerHTML = `<tr><td colspan="11" style="text-align: center; color: var(--text-dim); padding: 2rem;">No providers found.</td></tr>`;
        document.getElementById('viewAllContainer')?.remove();
        return;
      }
      
      const totalCount = providers.length;
      const displayProviders = (limit && !showAllProviders) ? providers.slice(0, limit) : providers;
      const hasMore = limit && !showAllProviders && totalCount > limit;

      // Render Table View
      tableBody.innerHTML = displayProviders.map(p => {
        const isOnline = p.status === 'ONLINE';
        const serviceCount = p.services?.length || 0;
        
        // Generate chain tags (limit to 3)
        const chainTags = p.services?.slice(0, 3).map(s => 
          `<span class="chain-tag">${escapeHtml(s.name.split('-')[0])}</span>`
        ).join('') || '';
        const moreTags = serviceCount > 3 ? `<span class="chain-tag more">+${serviceCount - 3}</span>` : '';
        
        const repScore = state.reputationScores[p.pubkey]?.total || 0;
        const repClass = getReputationClass(repScore);
        const repBadge = getReputationBadge(repScore);
        const repTip = reputationTooltip(p.pubkey);
        
        return `
          <tr>
            <td class="provider-name-cell">
              ${escapeHtml(p.name || 'Unknown')}
              <small>${p.location || 'Unknown region'}</small>
            </td>
            <td>
              <span class="rep-score ${repClass}" title="${repTip}">
                ${repBadge} ${repScore}
                <span class="rep-bar"><span class="rep-bar-fill" style="width:${repScore}%"></span></span>
              </span>
            </td>
            <td>
              <div class="data-types">${chainTags}${moreTags}</div>
            </td>
            <td>${escapeHtml(p.location || 'Unknown')}</td>
            <td style="color: var(--arkeo); font-weight: 600;">${getProviderQpm(p.pubkey)}</td>
            <td>
              <span class="provider-status ${isOnline ? 'online' : 'offline'}">
                ${isOnline ? '‚óè Online' : '‚óã Offline'}
              </span>
            </td>
            <td>${healthHtml(p, false)}</td>
            <td style="display: flex; gap: 0.5rem;">
              <a href="provider.html?pubkey=${encodeURIComponent(p.pubkey || '')}" class="btn btn-secondary btn-sm">Details</a>
              <a href="subscribe.html?provider=${encodeURIComponent(p.pubkey || '')}" class="btn btn-primary btn-sm">Subscribe</a>
            </td>
          </tr>
        `;
      }).join('');

      // Add "View All" button if there are more providers
      let viewAllContainer = document.getElementById('viewAllContainer');
      if (hasMore) {
        if (!viewAllContainer) {
          viewAllContainer = document.createElement('div');
          viewAllContainer.id = 'viewAllContainer';
          viewAllContainer.style.cssText = 'text-align: center; padding: 1.5rem; border-top: 1px solid var(--border);';
          document.getElementById('providerTableContainer').appendChild(viewAllContainer);
        }
        viewAllContainer.innerHTML = `
          <button onclick="toggleShowAll()" class="btn btn-secondary" style="min-width: 200px;">
            View All ${totalCount} Providers ‚Üí
          </button>
        `;
      } else if (showAllProviders && viewAllContainer) {
        viewAllContainer.innerHTML = `
          <button onclick="toggleShowAll()" class="btn btn-secondary" style="min-width: 200px;">
            ‚Üê Show Less
          </button>
        `;
      } else if (viewAllContainer) {
        viewAllContainer.remove();
      }

      // Render Grid View
      grid.innerHTML = displayProviders.map(p => {
        const isOnline = p.status === 'ONLINE';
        const totalBond = formatArkeo(p.totalBond);
        const serviceCount = p.services?.length || 0;
        const pubkeyShort = p.pubkey ? `${p.pubkey.slice(0, 12)}...${p.pubkey.slice(-6)}` : '-';
        
        // Get list of chain names (limit to 3 displayed)
        const chainNames = p.services?.slice(0, 3).map(s => s.name).join(', ') || 'No services';
        const moreChains = serviceCount > 3 ? ` +${serviceCount - 3} more` : '';
        
        // Simulated data
        const transactions = Math.floor((p.totalBond || 0) / 100000000 * 1000 + Math.random() * 500);
        const earnings = formatArkeo(transactions * 1000);

        const gRepScore = state.reputationScores[p.pubkey]?.total || 0;
        const gRepClass = getReputationClass(gRepScore);
        const gRepBadge = getReputationBadge(gRepScore);
        const gRepTip = reputationTooltip(p.pubkey);
        
        return `
          <div class="provider-card">
            <div class="rep-card" title="${gRepTip}">
              <div class="rep-card-score ${gRepClass}">${gRepBadge} ${gRepScore}</div>
              <div class="rep-card-label">Reputation Score</div>
            </div>
            <div class="provider-header">
              <div>
                <div class="provider-name">${escapeHtml(p.name || 'Unknown Provider')}</div>
                <div class="provider-service" title="${escapeHtml(p.pubkey)}">${pubkeyShort}</div>
              </div>
              <span class="provider-status ${isOnline ? 'online' : 'offline'}">
                ${isOnline ? '‚óè Online' : '‚óã Offline'}
              </span>
            </div>
            <div style="margin-bottom: 0.5rem;">${healthHtml(p, true)}</div>
            ${p.description ? `<p style="color: var(--text-dim); font-size: 0.85rem; margin-bottom: 1rem; line-height: 1.4;">${escapeHtml(p.description.slice(0, 100))}${p.description.length > 100 ? '...' : ''}</p>` : ''}
            <div style="margin-bottom: 1rem;">
              <div style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 0.25rem;">Supported Chains</div>
              <div style="font-size: 0.85rem; color: var(--text-dim);">${escapeHtml(chainNames)}${moreChains}</div>
            </div>
            <div class="provider-stats">
              <div class="provider-stat">
                <div class="provider-stat-value">${transactions.toLocaleString()}</div>
                <div class="provider-stat-label">Transactions <span class="badge-estimated" title="Estimated">Est.</span></div>
              </div>
              <div class="provider-stat">
                <div class="provider-stat-value" style="color: var(--success);">${earnings}</div>
                <div class="provider-stat-label">ARKEO Earned <span class="badge-estimated" title="Estimated">Est.</span></div>
              </div>
              <div class="provider-stat">
                <div class="provider-stat-value">${totalBond}</div>
                <div class="provider-stat-label">Bond</div>
              </div>
            </div>
            <div class="provider-actions">
              <a href="subscribe.html?provider=${encodeURIComponent(p.pubkey || '')}" class="btn btn-primary">Subscribe</a>
              <button class="btn btn-secondary" onclick="viewDetails('${escapeHtml(p.pubkey)}')">Details</button>
            </div>
          </div>
        `;
      }).join('');
    }

    function filterProviders() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const dataType = document.getElementById('dataTypeFilter').value;
      const region = document.getElementById('regionFilter').value;
      const status = document.getElementById('statusFilter').value;
      const sortBy = document.getElementById('sortBy').value;

      // Common chain name aliases (search term ‚Üí actual service name)
      const chainAliases = {
        'cosmos': 'gaia', 'atom': 'gaia', 'cosmoshub': 'gaia',
        'thor': 'thorchain', 'rune': 'thorchain',
        'btc': 'bitcoin', 'eth': 'ethereum',
        'bnb': 'binance', 'bsc': 'binance',
        'avax': 'avalanche', 'sol': 'solana',
        'dot': 'polkadot', 'matic': 'polygon',
        'arb': 'arbitrum', 'op': 'optimism',
      };
      const expandedSearch = chainAliases[search] || search;

      let filtered = Object.values(state.providerInfos).filter(p => {
        // Filter out localhost/misconfigured providers
        const uri = p.metadataUri || '';
        if (uri.includes('127.0.0.1') || uri.includes('localhost')) return false;

        // Search filter - search provider name, chains, or pubkey
        const providerName = (p.name || '').toLowerCase();
        const chainNames = p.services?.map(s => s.name.toLowerCase()).join(' ') || '';
        const serviceDescs = p.services?.map(s => (s.description || '').toLowerCase()).join(' ') || '';
        const matchesSearch = providerName.includes(expandedSearch) || 
                             chainNames.includes(expandedSearch) ||
                             serviceDescs.includes(expandedSearch) ||
                             providerName.includes(search) ||
                             chainNames.includes(search) ||
                             (p.pubkey && p.pubkey.toLowerCase().includes(search));
        
        // Data type filter
        const matchesDataType = dataType === 'all' || chainNames.includes(dataType);
        
        // Region filter
        const providerRegion = (p.location || '').toLowerCase();
        const matchesRegion = region === 'all' || 
                             (region === 'americas' && providerRegion.includes('america')) ||
                             (region === 'europe' && providerRegion.includes('europe')) ||
                             (region === 'asia' && (providerRegion.includes('asia') || providerRegion.includes('pacific')));
        
        // Status filter
        const matchesStatus = status === 'all' || 
                             (status === 'online' && p.status === 'ONLINE') ||
                             (status === 'offline' && p.status !== 'ONLINE');

        return matchesSearch && matchesDataType && matchesRegion && matchesStatus;
      });

      // Sort
      filtered.sort((a, b) => {
        if (sortBy === 'reputation') {
          return (state.reputationScores[b.pubkey]?.total || 0) - (state.reputationScores[a.pubkey]?.total || 0);
        } else if (sortBy === 'earnings' || sortBy === 'transactions') {
          return (b.totalBond || 0) - (a.totalBond || 0);
        } else if (sortBy === 'bond') {
          return (b.totalBond || 0) - (a.totalBond || 0);
        } else if (sortBy === 'rate') {
          // Average rate comparison
          const avgRateA = a.services?.length > 0 
            ? a.services.reduce((sum, s) => sum + parseInt(s.rate || 0), 0) / a.services.length 
            : 999999999;
          const avgRateB = b.services?.length > 0 
            ? b.services.reduce((sum, s) => sum + parseInt(s.rate || 0), 0) / b.services.length 
            : 999999999;
          return avgRateA - avgRateB;
        }
        return 0;
      });

      renderProviders(filtered, 5);
    }

    // Live health check ‚Äî pings each provider's metadata endpoint
    async function runLiveHealthChecks(providers) {
      const checks = providers.map(async (p) => {
        // Find a metadata URI to ping
        const metaUri = p.metadataUri;
        if (!metaUri || !metaUri.startsWith('http')) return;
        
        try {
          // Try HTTPS first (works from GitHub Pages), fall back to no-cors ping for HTTP
          const url = metaUri.startsWith('https') ? metaUri : metaUri.replace(/^http:/, 'https:');
          const resp = await fetch(url, { mode: 'cors', signal: AbortSignal.timeout(5000) });
          if (resp.ok) {
            const known = findKnown(p.pubkey);
            if (known) known.health = 'healthy';
            else KNOWN_PROVIDERS[p.pubkey] = { name: p.name || 'Unknown', health: 'healthy' };
          } else {
            const known = findKnown(p.pubkey);
            if (known) known.health = 'unhealthy';
          }
        } catch (e) {
          // HTTPS failed ‚Äî can't verify from browser (mixed content). Leave health as-is from providers.js.
        }
      });
      
      await Promise.allSettled(checks);
      
      // Re-render with updated health
      const onlineProviders = Object.values(state.providerInfos).filter(p => {
        if (p.status !== 'ONLINE' || p.totalBond < parseInt(CONFIG.MIN_BOND)) return false;
        const uri = p.metadataUri || '';
        if (uri.includes('localhost') || uri.includes('127.0.0.1')) return false;
        const isKnown = !!findKnown(p.pubkey);
        if (!isKnown && (!uri || uri.trim() === '')) return false;
        return true;
      });
      onlineProviders.sort((a, b) => {
        const aHealth = (KNOWN_PROVIDERS[a.pubkey]?.health === 'healthy') ? 1 : 0;
        const bHealth = (KNOWN_PROVIDERS[b.pubkey]?.health === 'healthy') ? 1 : 0;
        if (bHealth !== aHealth) return bHealth - aHealth;
        return (state.reputationScores[b.pubkey]?.total || 0) - (state.reputationScores[a.pubkey]?.total || 0);
      });
      renderProviders(onlineProviders, 5);
    }

    function getHealthIndicator(provider) {
      const pk = provider.pubkey;
      const uri = provider.metadataUri || '';
      const isLocalhost = uri.includes('127.0.0.1') || uri.includes('localhost');
      const known = findKnown(pk);
      const health = known?.health || 'unknown';
      const contractCount = state.contractsByProvider[pk] || 0;
      
      if (isLocalhost) {
        return { dot: 'üî¥', label: 'Misconfigured', cls: 'health-bad', title: 'Provider uses localhost URI ‚Äî not reachable by users' };
      }
      if (health === 'healthy' && contractCount > 0) {
        return { dot: 'üü¢', label: `Active ¬∑ ${contractCount} contract${contractCount > 1 ? 's' : ''}`, cls: 'health-good', title: 'Sentinel responding, actively serving contracts' };
      }
      if (health === 'healthy') {
        return { dot: 'üü¢', label: 'Ready', cls: 'health-good', title: 'Sentinel responding and ready for contracts' };
      }
      if (health === 'unhealthy') {
        return { dot: 'üî¥', label: 'Unreachable', cls: 'health-bad', title: 'Sentinel not responding ‚Äî provider may be offline' };
      }
      if (provider.status === 'ONLINE') {
        return { dot: 'üü°', label: 'Unverified', cls: 'health-warn', title: 'On-chain status is ONLINE but health not verified' };
      }
      return { dot: 'üî¥', label: 'Offline', cls: 'health-bad', title: 'Provider is offline' };
    }

    function healthHtml(provider, compact) {
      const h = getHealthIndicator(provider);
      if (compact) {
        return `<span title="${h.title}" style="cursor:help;">${h.dot} <span style="font-size:0.75rem;color:var(--text-dim);">${h.label}</span></span>`;
      }
      return `<span title="${h.title}" style="cursor:help;">${h.dot} ${h.label}</span>`;
    }

    function viewDetails(pubkey) {
      window.location.href = 'provider.html?pubkey=' + encodeURIComponent(pubkey);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text || '';
      return div.innerHTML;
    }

    // ============================================================
    // EARNINGS CHART
    // ============================================================
    function calculateProviderEarnings() {
      // Use only verified providers with real names from metadata
      const providers = Object.values(state.providerInfos);
      
      // Calculate estimated earnings based on bond size and service count
      const providerEarnings = providers.map(p => {
        const bondInArkeo = (p.totalBond || 0) / CONFIG.ARKEO_DIVISOR;
        const serviceCount = p.services?.length || 0;
        const activityMultiplier = Math.min(serviceCount * 0.15, 1);
        
        // Estimate earnings based on bond and activity
        // In production, this would come from the directory service
        const estimatedEarnings = bondInArkeo * activityMultiplier * (0.5 + Math.random() * 0.3);
        
        return {
          pubkey: p.pubkey,
          name: p.name || `Provider ${p.pubkey?.slice(-8) || 'Unknown'}`,
          totalBond: p.totalBond,
          serviceCount: serviceCount,
          estimatedEarnings: estimatedEarnings,
          status: p.status,
        };
      });
      
      // Sort by estimated earnings and take top 10
      const sorted = providerEarnings
        .filter(p => p.estimatedEarnings > 0.0001 && p.status === 'ONLINE')
        .sort((a, b) => b.estimatedEarnings - a.estimatedEarnings)
        .slice(0, CONFIG.CHART_TOP_N || 10);
      
      return sorted;
    }
    
    function formatCompact(val) {
      if (val >= 1e6) return (val / 1e6).toFixed(1) + 'M';
      if (val >= 1e3) return (val / 1e3).toFixed(1) + 'K';
      return val.toFixed(2);
    }

    function renderEarningsChart() {
      const earnings = calculateProviderEarnings();
      const totalEl = document.getElementById('totalProviderEarnings');
      const avgEl = document.getElementById('avgProviderEarnings');
      if (!totalEl || !avgEl) return;

      if (earnings.length === 0) {
        totalEl.textContent = '0';
        avgEl.textContent = '0';
        return;
      }

      const total = earnings.reduce((sum, e) => sum + e.estimatedEarnings, 0);
      const avg = total / earnings.length;
      totalEl.textContent = formatCompact(total);
      avgEl.textContent = formatCompact(avg);
    }

    // ============================================================
    // COMPETITOR COMPARISON
    // ============================================================
    const COMPETITORS = [
      {
        name: 'Infura', type: 'centralized', website: 'https://infura.io',
        freeTier: '100K req/day', costPer1M: '~$5.00', cosmos: false, thorchain: false,
        kyc: 'Email required', advantage: 'Most established (since 2016), MetaMask integration'
      },
      {
        name: 'Alchemy', type: 'centralized', website: 'https://alchemy.com',
        freeTier: '~1.15M req/mo', costPer1M: '~$10.00', cosmos: false, thorchain: false,
        kyc: 'Email required', advantage: 'Enhanced APIs (NFT, Token), generous free tier'
      },
      {
        name: 'QuickNode', type: 'centralized', website: 'https://quicknode.com',
        freeTier: '~2.5M req/mo', costPer1M: '~$5.00', cosmos: false, thorchain: false,
        kyc: 'Email required', advantage: 'Add-on marketplace, strong Solana support'
      },
      {
        name: 'Chainstack', type: 'centralized', website: 'https://chainstack.com',
        freeTier: '3M req/mo', costPer1M: '~$2.45', cosmos: false, thorchain: false,
        kyc: 'Email required', advantage: 'Cheapest centralized, 70+ chains, accepts crypto'
      },
      {
        name: 'GetBlock', type: 'centralized', website: 'https://getblock.io',
        freeTier: '50K CU/day', costPer1M: '~$0.78', cosmos: true, thorchain: false,
        kyc: 'Email required', advantage: 'Dedicated nodes, some Cosmos support, accepts crypto'
      },
      {
        name: 'Pocket (POKT)', type: 'decentralized', website: 'https://pocket.network',
        freeTier: 'Free public RPCs', costPer1M: '~$0.001', cosmos: true, thorchain: false,
        kyc: 'None', advantage: 'Truly permissionless, 60+ chains, DAO governed'
      },
      {
        name: 'Lava Network', type: 'decentralized', website: 'https://lavanet.xyz',
        freeTier: 'Free public RPCs', costPer1M: 'Token-based', cosmos: true, thorchain: false,
        kyc: 'None', advantage: 'Smart routing to fastest provider, strong Cosmos focus'
      },
      {
        name: 'Arkeo', type: 'arkeo', website: '#',
        freeTier: '10 req/day (free tier)', costPer1M: 'Market-priced', cosmos: true, thorchain: true,
        kyc: 'None', advantage: 'Open marketplace, THORChain support, ARKEO discount, auto-failover'
      },
    ];

    let compTab = 'centralized';

    function showCompTab(tab) {
      compTab = tab;
      document.getElementById('tabCentralized').classList.toggle('active', tab === 'centralized');
      document.getElementById('tabDecentralized').classList.toggle('active', tab === 'decentralized');
      document.getElementById('tabAll').classList.toggle('active', tab === 'all');
      renderCompTable();
    }

    function renderCompTable() {
      const tbody = document.getElementById('compTableBody');
      const filtered = COMPETITORS.filter(c => {
        if (compTab === 'all') return true;
        if (compTab === 'centralized') return c.type === 'centralized';
        if (compTab === 'decentralized') return c.type === 'decentralized' || c.type === 'arkeo';
        return true;
      });

      tbody.innerHTML = filtered.map(c => {
        const isArkeo = c.type === 'arkeo';
        const rowStyle = isArkeo ? 'background: rgba(59, 224, 255, 0.05);' : '';
        const nameStyle = isArkeo ? 'color: var(--arkeo); font-weight: 700;' : '';
        const typeLabel = c.type === 'centralized' ? 'üè¢ Centralized' : c.type === 'decentralized' ? 'üåê Decentralized' : '‚ö° Decentralized';
        const check = '<span style="color: var(--success);">‚úì</span>';
        const cross = '<span style="color: var(--text-muted);">‚úó</span>';

        return `<tr style="${rowStyle}">
          <td class="provider-name-cell" style="${nameStyle}">
            ${isArkeo ? '‚ö° ' : ''}<a href="${c.website}" target="_blank" style="color: inherit; text-decoration: none;">${c.name}</a>
          </td>
          <td style="font-size: 0.8rem;">${typeLabel}</td>
          <td style="font-size: 0.85rem;">${c.freeTier}</td>
          <td style="font-weight: 600;">${c.costPer1M}</td>
          <td style="text-align: center;">${c.cosmos ? check : cross}</td>
          <td style="text-align: center;">${c.thorchain ? check : cross}</td>
          <td style="font-size: 0.85rem;">${c.kyc}</td>
          <td style="font-size: 0.8rem; color: var(--text-dim);">${c.advantage}</td>
        </tr>`;
      }).join('');
    }

    // ============================================================
    // INITIALIZE
    // ============================================================
    document.addEventListener('DOMContentLoaded', () => {
      // Load initial data
      renderCompTable();
      loadData();
      
      // Start auto-refresh (every 30 seconds when tab is visible)
      startAutoRefresh();
      
      // Global error handler
      window.onerror = (msg, url, line, col, error) => {
        ErrorHandler.handle(error || new Error(msg), `Global: ${url}:${line}`);
        return false; // Let browser handle too
      };
      
      // Handle unhandled promise rejections
      window.onunhandledrejection = (event) => {
        ErrorHandler.handle(event.reason, 'Unhandled Promise');
      };
      
      if (CONFIG.DEBUG_MODE) {
        console.log('Arkeo Marketplace initialized', { config: CONFIG });
      }
    });
  </script>
</body>
</html>
